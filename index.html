<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>‡¶°‡¶ø‡¶ú‡¶ø‡¶ü‡¶æ‡¶≤ ‡¶π‡¶ø‡¶∏‡¶æ‡¶¨ ‡¶ñ‡¶æ‡¶§‡¶æ</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
  <style>
    @font-face {
      font-family: 'Li Ador Noirrit Regular';
      src: url('Li Ador Noirrit Regular.ttf') format('truetype');
    }

    body {
      font-family: 'Li Ador Noirrit Regular', Arial, sans-serif;
      margin: 20px;
      background-color: #fff9f9;
      transition: background-color 0.3s, color 0.3s;
    }

    @media (max-width: 768px) {
      body {
        margin: 10px;
        padding-top: 50px;
      }
    }

    body.dark-theme {
      background-color: #1a1a1a;
      color: #e0e0e0;
    }

    body.dark-theme .table {
      color: #e0e0e0;
    }

    body.dark-theme .form-control {
      background-color: #2d2d2d;
      color: #e0e0e0;
      border-color: #444;
    }

    body.dark-theme .card {
      background-color: #2d2d2d;
      color: #e0e0e0;
    }

    body.dark-theme .table-bordered {
      border-color: #444;
    }

    body.dark-theme .table-bordered td,
    body.dark-theme .table-bordered th {
      border-color: #444;
    }

    table {
      margin-top: 20px;
    }

    @media (max-width: 768px) {
      table {
        font-size: 0.85rem;
      }
      
      table th,
      table td {
        padding: 8px 4px;
      }
      
      .table-responsive {
        overflow-x: auto;
        -webkit-overflow-scrolling: touch;
      }
    }

    .rounded-button {
      border-radius: 15px;
    }

    @media (max-width: 768px) {
      .rounded-button {
        font-size: 0.85rem;
        padding: 8px 12px;
      }
    }

    .rounded-card {
      border-radius: 20px;
    }

    .toast-container {
      position: fixed;
      top: 20px;
      right: 20px;
      z-index: 1055;
    }

    .smaller-popup {
      max-width: 350px;
      font-size: 0.9rem;
      border-radius: 10px;
    }

    .theme-toggle {
      position: fixed;
      top: 20px;
      left: 20px;
      z-index: 1000;
      background: none;
      border: none;
      width: 50px;
      height: 50px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.5rem;
      transition: all 0.3s;
    }

    @media (max-width: 768px) {
      .theme-toggle {
        position: absolute;
        top: 10px;
        right: 10px;
        left: auto;
        width: 40px;
        height: 40px;
        font-size: 1.2rem;
      }
    }

    .theme-toggle:hover {
      transform: scale(1.1);
    }

    .action-buttons {
      position: fixed;
      top: 80px;
      left: 20px;
      z-index: 1000;
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    @media (max-width: 768px) {
      .action-buttons {
        position: relative;
        top: 0;
        left: 0;
        flex-direction: row;
        flex-wrap: wrap;
        justify-content: center;
        margin: 10px 0;
        padding: 0 10px;
      }
    }

    .action-btn {
      background: white;
      border: 2px solid #333;
      border-radius: 8px;
      padding: 8px 12px;
      cursor: pointer;
      font-size: 0.85rem;
      transition: all 0.3s;
      white-space: nowrap;
    }

    @media (max-width: 768px) {
      .action-btn {
        font-size: 0.75rem;
        padding: 6px 10px;
        flex: 0 0 auto;
      }
    }

    .action-btn:hover {
      background: #f0f0f0;
      transform: translateX(5px);
    }

    body.dark-theme .action-btn {
      background: #2d2d2d;
      border-color: #e0e0e0;
      color: #e0e0e0;
    }

    body.dark-theme .action-btn:hover {
      background: #3d3d3d;
    }

    .search-container {
      margin: 20px 0;
    }

    @media (max-width: 768px) {
      .search-container {
        margin: 10px 0;
      }
    }

    .search-input {
      border-radius: 20px;
      padding: 10px 20px;
    }

    @media (max-width: 768px) {
      .search-input {
        font-size: 0.9rem;
        padding: 8px 15px;
      }
    }

    body.dark-theme .modal-content {
      background-color: #2d2d2d;
      color: #e0e0e0;
    }

    body.dark-theme .modal-header {
      border-color: #444;
    }

    body.dark-theme .modal-footer {
      border-color: #444;
    }

    .history-item {
      padding: 10px;
      border-left: 3px solid #0d6efd;
      margin-bottom: 10px;
      background: #f8f9fa;
      border-radius: 5px;
    }

    body.dark-theme .history-item {
      background: #3d3d3d;
      border-left-color: #5ea3ff;
    }

    .history-item strong {
      color: #000;
    }

    body.dark-theme .history-item strong {
      color: #fff;
    }

    .history-item small {
      color: #666;
    }

    body.dark-theme .history-item small {
      color: #aaa;
    }

    h1, h3 {
      word-wrap: break-word;
    }

    @media (max-width: 768px) {
      h1 {
        font-size: 1.5rem;
        margin-top: 10px;
      }
      
      h3 {
        font-size: 1.2rem;
      }
      
      .col-md-3 {
        margin-bottom: 15px;
      }
      
      .btn.rounded-pill {
        font-size: 0.85rem;
      }
    }
  </style>
</head>

<body>
  <button class="theme-toggle" onclick="toggleTheme()" id="themeToggle">üåô</button>
  
  <div class="action-buttons">
    <button class="action-btn" onclick="exportData()">üíæ ‡¶¨‡ßç‡¶Ø‡¶æ‡¶ï‡¶Ü‡¶™</button>
    <button class="action-btn" onclick="importData()">üì• ‡¶∞‡¶ø‡¶∏‡ßç‡¶ü‡ßã‡¶∞</button>
    <button class="action-btn" onclick="exportCSV()">üìä CSV</button>
    <button class="action-btn" onclick="showCharts()">üìà ‡¶ö‡¶æ‡¶∞‡ßç‡¶ü</button>
    <button class="action-btn" onclick="showHistory()">üìú ‡¶π‡¶ø‡¶∏‡ßç‡¶ü‡ßç‡¶∞‡¶ø</button>
    <button class="action-btn" onclick="clearAllData()">üóëÔ∏è ‡¶ï‡ßç‡¶≤‡¶ø‡¶Ø‡¶º‡¶æ‡¶∞</button>
  </div>

  <div class="container">
    <div class="row">
      <h1 class="text-center">‡¶°‡¶ø‡¶ú‡¶ø‡¶ü‡¶æ‡¶≤ ‡¶π‡¶ø‡¶∏‡¶æ‡¶¨ ‡¶ñ‡¶æ‡¶§‡¶æ</h1>
      
      <div class="search-container">
        <input type="text" class="form-control search-input" id="searchInput" placeholder="üîç ‡¶∏‡¶æ‡¶∞‡ßç‡¶ö ‡¶ï‡¶∞‡ßÅ‡¶®..." onkeyup="searchTables()">
      </div>

      <h3>‡¶ï‡ßç‡¶Ø‡¶æ‡¶∂ ‡¶ü‡¶æ‡¶ï‡¶æ</h3>
      <div class="table-responsive">
        <table class="table table-bordered">
          <thead class="table-dark">
            <tr>
              <th>‡¶∏‡ßã‡¶∞‡ßç‡¶∏</th>
              <th>‡¶è‡¶Æ‡¶æ‡¶â‡¶®‡ßç‡¶ü</th>
              <th>‡¶è‡¶ï‡¶∂‡¶®</th>
            </tr>
          </thead>
          <tbody id="cashTable"></tbody>
        </table>
      </div>
      <button class="btn btn-success rounded-button mb-3" style="max-width:40%; margin: auto;" onclick="addCash()">‡¶â‡ßé‡¶∏
        ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶®</button>
      <hr>
      <h3>‡¶¨‡¶æ‡¶ï‡¶ø ‡¶π‡¶ø‡¶∏‡¶æ‡¶¨</h3>
      <div class="table-responsive">
        <table class="table table-bordered">
          <thead class="table-dark">
            <tr>
              <th>‡¶®‡¶æ‡¶Æ</th>
              <th>‡¶è‡¶Æ‡¶æ‡¶â‡¶®‡ßç‡¶ü</th>
              <th>‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ</th>
              <th>‡¶è‡¶ï‡¶∂‡¶®</th>
            </tr>
          </thead>
          <tbody id="dueTable"></tbody>
        </table>
      </div>
      <button class="btn btn-success rounded-button mb-3" onclick="addDue()"
        style="max-width:40%; margin: auto;">‡¶¨‡ßç‡¶Ø‡¶ï‡ßç‡¶§‡¶ø ‡¶Ø‡ßÅ‡¶ï‡ßç‡¶§ ‡¶ï‡¶∞‡ßÅ‡¶®</button>
      <hr>
      <h3>‡¶≤‡ßã‡¶® ‡¶è‡¶∞ ‡¶π‡¶ø‡¶∏‡¶æ‡¶¨</h3>
      <div class="table-responsive">
        <table class="table table-bordered">
          <thead class="table-dark">
            <tr>
              <th>‡¶®‡¶æ‡¶Æ</th>
              <th>‡¶è‡¶Æ‡¶æ‡¶â‡¶®‡ßç‡¶ü</th>
              <th>‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ</th>
              <th>‡¶è‡¶ï‡¶∂‡¶®</th>
            </tr>
          </thead>
          <tbody id="loanTable"></tbody>
        </table>
      </div>
      <button class="btn btn-success rounded-button mb-3" onclick="addLoan()"
        style="max-width:40%; margin: auto;">‡¶≤‡ßã‡¶® ‡¶Ø‡ßÅ‡¶ï‡ßç‡¶§ ‡¶ï‡¶∞‡ßÅ‡¶®</button>
      <hr>
      <div class="mt-4">
        <h1 class="text-center">‡¶∏‡¶û‡ßç‡¶ö‡¶Ø‡¶º ‡¶ì ‡¶™‡¶æ‡¶ì‡¶®‡¶æ ‡¶è‡¶∞ ‡¶π‡¶ø‡¶∏‡¶æ‡¶¨</h1>
        <div class="card shadow-sm border-0 rounded-card">
          <div class="card-body">
            <div class="row text-center">
              <div class="col-md-3 mb-3">
                <h6>‡¶¨‡¶∞‡ßç‡¶§‡¶Æ‡¶æ‡¶® ‡¶ï‡ßç‡¶Ø‡¶æ‡¶∂</h6>
                <button class="btn btn-info rounded-pill w-75 py-2" id="currentTotal">‡ß≥0</button>
              </div>
              <div class="col-md-3 mb-3">
                <h6>‡¶™‡¶æ‡¶ì‡¶®‡¶æ ‡¶¨‡¶æ‡¶ï‡¶ø</h6>
                <button class="btn btn-warning rounded-pill w-75 py-2" id="totalDue">‡ß≥0</button>
              </div>
              <div class="col-md-3 mb-3">
                <h6>‡¶≤‡ßã‡¶®</h6>
                <button class="btn btn-danger rounded-pill w-75 py-2" id="totalLoan">‡ß≥0</button>
              </div>
              <div class="col-md-3 mb-3">
                <h6>‡¶∏‡¶∞‡ßç‡¶¨‡¶Æ‡ßã‡¶ü</h6>
                <button class="btn btn-success rounded-pill w-75 py-2" id="grandTotal">‡ß≥0</button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="toast-container">
    <div id="saveToast" class="toast align-items-center text-bg-success border-0" role="alert" aria-live="assertive"
      aria-atomic="true">
      <div class="d-flex">
        <div class="toast-body">
          ‡¶°‡ßá‡¶ü‡¶æ ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶∏‡¶Ç‡¶∞‡¶ï‡ßç‡¶∑‡¶£ ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá!
        </div>
        <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"
          aria-label="Close"></button>
      </div>
    </div>
  </div>

  <script>
    const cashData = JSON.parse(localStorage.getItem("cashData")) || [];
    const dueData = JSON.parse(localStorage.getItem("dueData")) || [];
    const loanData = JSON.parse(localStorage.getItem("loanData")) || [];
    let transactionHistory = JSON.parse(localStorage.getItem("transactionHistory")) || [];

    function addToHistory(action, details) {
      const historyEntry = {
        action: action,
        details: details,
        timestamp: new Date().toLocaleString("en-US", {
          year: "numeric",
          month: "short",
          day: "2-digit",
          hour: "2-digit",
          minute: "2-digit",
          hour12: true
        })
      };
      transactionHistory.unshift(historyEntry);
      if (transactionHistory.length > 100) transactionHistory = transactionHistory.slice(0, 100);
      localStorage.setItem("transactionHistory", JSON.stringify(transactionHistory));
    }

    function toggleTheme() {
      const body = document.body;
      const themeToggle = document.getElementById('themeToggle');
      
      body.classList.toggle('dark-theme');
      
      if (body.classList.contains('dark-theme')) {
        themeToggle.textContent = '‚òÄÔ∏è';
        localStorage.setItem('theme', 'dark');
      } else {
        themeToggle.textContent = 'üåô';
        localStorage.setItem('theme', 'light');
      }
    }

    function loadTheme() {
      const savedTheme = localStorage.getItem('theme');
      const themeToggle = document.getElementById('themeToggle');
      
      if (savedTheme === 'dark') {
        document.body.classList.add('dark-theme');
        themeToggle.textContent = '‚òÄÔ∏è';
      }
    }

    loadTheme();

    function renderTables() {
      const cashTable = document.getElementById("cashTable");
      const dueTable = document.getElementById("dueTable");
      const loanTable = document.getElementById("loanTable");

      let cashTableHTML = "";
      cashData.forEach((entry, index) => {
        cashTableHTML += `
      <tr>
        <td><input type="text" class="form-control" value="${entry.method}" onchange="updateCash(${index}, 'method', this.value)"></td>
        <td><input type="number" class="form-control" value="${entry.amount}" onchange="updateCash(${index}, 'amount', parseFloat(this.value))"></td>
        <td>
          <div class="d-flex flex-wrap gap-2 justify-content-start">
            <button class="btn btn-success rounded-button" onclick="depositCash(${index})">‡¶°‡¶ø‡¶™‡ßã‡¶ú‡¶ø‡¶ü</button>
            <button class="btn btn-danger rounded-button" onclick="deleteCash(${index})">‡¶°‡¶ø‡¶≤‡¶ø‡¶ü</button>
          </div>
        </td>
      </tr>`;
      });

      let dueTableHTML = "";
      dueData.forEach((entry, index) => {
        dueTableHTML += `
      <tr>
        <td><input type="text" class="form-control" value="${entry.person}" onchange="updateDue(${index}, 'person', this.value)"></td>
        <td><input type="number" class="form-control" value="${entry.amount}" onchange="updateDue(${index}, 'amount', parseFloat(this.value))"></td>
        <td>${entry.timestamp}</td>
        <td><button class="btn btn-danger rounded-button" onclick="deleteDue(${index})">‡¶°‡¶ø‡¶≤‡¶ø‡¶ü</button></td>
      </tr>`;
      });

      let loanTableHTML = "";
      loanData.forEach((entry, index) => {
        loanTableHTML += `
      <tr>
        <td><input type="text" class="form-control" value="${entry.person}" onchange="updateLoan(${index}, 'person', this.value)"></td>
        <td><input type="number" class="form-control" value="${entry.amount}" onchange="updateLoan(${index}, 'amount', parseFloat(this.value))"></td>
        <td>${entry.timestamp}</td>
        <td><button class="btn btn-danger rounded-button" onclick="deleteLoan(${index})">‡¶°‡¶ø‡¶≤‡¶ø‡¶ü</button></td>
      </tr>`;
      });

      cashTable.innerHTML = cashTableHTML;
      dueTable.innerHTML = dueTableHTML;
      loanTable.innerHTML = loanTableHTML;

      calculateTotals();
    }


    function addCash() {
      cashData.push({ method: "‡¶∏‡ßã‡¶∞‡ßç‡¶∏", amount: 0 });
      addToHistory('‡¶ï‡ßç‡¶Ø‡¶æ‡¶∂ ‡¶Ø‡ßã‡¶ó', '‡¶®‡¶§‡ßÅ‡¶® ‡¶ï‡ßç‡¶Ø‡¶æ‡¶∂ ‡¶∏‡ßã‡¶∞‡ßç‡¶∏ ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá');
      renderTables();
    }

    function depositCash(index) {
      let currentCash = cashData[index]['amount'];
      Swal.fire({
        title: '‡¶ï‡ßç‡¶Ø‡¶æ‡¶∂ ‡¶°‡¶ø‡¶™‡ßã‡¶ú‡¶ø‡¶ü',
        input: 'number',
        inputLabel: '‡¶°‡¶ø‡¶™‡ßã‡¶ú‡¶ø‡¶ü ‡¶è‡¶Æ‡¶æ‡¶â‡¶®‡ßç‡¶ü ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®',
        showCancelButton: true,
        customClass: {
          popup: 'smaller-popup'
        },
        confirmButtonText: '‡¶°‡¶ø‡¶™‡ßã‡¶ú‡¶ø‡¶ü',
        cancelButtonText: '‡¶ï‡ßç‡¶Ø‡¶æ‡¶®‡¶∏‡ßá‡¶≤'
      }).then((result) => {
        if (result.isConfirmed) {
          const deposit = parseFloat(result.value);
          if (!isNaN(deposit)) {
            currentCash += deposit
            updateCash(index, 'amount', currentCash)
            addToHistory('‡¶°‡¶ø‡¶™‡ßã‡¶ú‡¶ø‡¶ü', `${cashData[index].method} ‡¶è ‡ß≥${deposit} ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá`);
            showToast()
          };
        };
      });
    }

    function date() {
      const currentDate = new Date();
      const formattedDate = currentDate.toLocaleString("en-US", {
        year: "numeric",
        month: "short",
        day: "2-digit",
        hour: "2-digit",
        minute: "2-digit",
        hour12: true
      });

      return formattedDate;
    }

    function addDue() {
      dueData.push({ person: "‡¶®‡¶æ‡¶Æ", amount: 0, timestamp: date() });
      addToHistory('‡¶¨‡¶æ‡¶ï‡¶ø ‡¶Ø‡ßã‡¶ó', '‡¶®‡¶§‡ßÅ‡¶® ‡¶¨‡¶æ‡¶ï‡¶ø ‡¶è‡¶®‡ßç‡¶ü‡ßç‡¶∞‡¶ø ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá');
      renderTables();
    }

    function addLoan() {
      loanData.push({ person: "‡¶®‡¶æ‡¶Æ", amount: 0, timestamp: date() });
      addToHistory('‡¶≤‡ßã‡¶® ‡¶Ø‡ßã‡¶ó', '‡¶®‡¶§‡ßÅ‡¶® ‡¶≤‡ßã‡¶® ‡¶è‡¶®‡ßç‡¶ü‡ßç‡¶∞‡¶ø ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá');
      renderTables();
    }

    function updateCash(index, key, value) {
      cashData[index][key] = value;
      saveData()
      renderTables();
    }

    function updateDue(index, key, value) {
      dueData[index][key] = value;
      saveData()
      renderTables();
    }

    function updateLoan(index, key, value) {
      loanData[index][key] = value;
      saveData()
      renderTables();
    }

    function deleteCash(index) {
      const item = cashData[index];
      cashData.splice(index, 1);
      addToHistory('‡¶ï‡ßç‡¶Ø‡¶æ‡¶∂ ‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶´‡ßá‡¶≤‡¶æ', `${item.method} ‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶´‡ßá‡¶≤‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá`);
      saveData()
      renderTables();
    }

    function deleteDue(index) {
      const item = dueData[index];
      dueData.splice(index, 1);
      addToHistory('‡¶¨‡¶æ‡¶ï‡¶ø ‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶´‡ßá‡¶≤‡¶æ', `${item.person} ‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶´‡ßá‡¶≤‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá`);
      saveData()
      renderTables();
    }

    function deleteLoan(index) {
      const item = loanData[index];
      loanData.splice(index, 1);
      addToHistory('‡¶≤‡ßã‡¶® ‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶´‡ßá‡¶≤‡¶æ', `${item.person} ‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶´‡ßá‡¶≤‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá`);
      saveData()
      renderTables();
    }

    function calculateTotals() {
      let currentTotal = 0, totalDue = 0, totalLoan = 0;

      cashData.forEach(entry => currentTotal += parseFloat(entry.amount) || 0);
      dueData.forEach(entry => totalDue += parseFloat(entry.amount) || 0);
      loanData.forEach(entry => totalLoan += parseFloat(entry.amount) || 0);

      const grandTotal = currentTotal + totalDue - totalLoan;

      document.getElementById("currentTotal").textContent = "‡ß≥" + currentTotal;
      document.getElementById("totalDue").textContent = "‡ß≥" + totalDue;
      document.getElementById("totalLoan").textContent = "‡ß≥" + totalLoan;
      document.getElementById("grandTotal").textContent = "‡ß≥" + grandTotal;
    }


    function saveData() {
      localStorage.setItem("cashData", JSON.stringify(cashData));
      localStorage.setItem("dueData", JSON.stringify(dueData));
      localStorage.setItem("loanData", JSON.stringify(loanData));
      showToast();
    }

    function showToast() {
      const toastElement = document.getElementById("saveToast");
      const toast = new bootstrap.Toast(toastElement);
      toast.show();
    }

    function searchTables() {
      const searchTerm = document.getElementById('searchInput').value.toLowerCase();
      const tables = ['cashTable', 'dueTable', 'loanTable'];
      
      tables.forEach(tableId => {
        const rows = document.getElementById(tableId).getElementsByTagName('tr');
        Array.from(rows).forEach(row => {
          const text = row.textContent.toLowerCase();
          row.style.display = text.includes(searchTerm) ? '' : 'none';
        });
      });
    }

    function exportData() {
      const data = {
        cashData: cashData,
        dueData: dueData,
        loanData: loanData,
        transactionHistory: transactionHistory,
        exportDate: new Date().toISOString()
      };
      
      const dataStr = JSON.stringify(data, null, 2);
      const dataBlob = new Blob([dataStr], { type: 'application/json' });
      const url = URL.createObjectURL(dataBlob);
      const link = document.createElement('a');
      link.href = url;
      link.download = `hishabkhata-backup-${new Date().toISOString().split('T')[0]}.json`;
      link.click();
      URL.revokeObjectURL(url);
      
      addToHistory('‡¶¨‡ßç‡¶Ø‡¶æ‡¶ï‡¶Ü‡¶™', '‡¶∏‡¶ï‡¶≤ ‡¶°‡ßá‡¶ü‡¶æ ‡¶è‡¶ï‡ßç‡¶∏‡¶™‡ßã‡¶∞‡ßç‡¶ü ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá');
      Swal.fire({
        icon: 'success',
        title: '‡¶¨‡ßç‡¶Ø‡¶æ‡¶ï‡¶Ü‡¶™ ‡¶∏‡¶´‡¶≤!',
        text: '‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶°‡ßá‡¶ü‡¶æ ‡¶°‡¶æ‡¶â‡¶®‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá',
        customClass: { popup: 'smaller-popup' }
      });
    }

    function importData() {
      const input = document.createElement('input');
      input.type = 'file';
      input.accept = 'application/json';
      
      input.onchange = (e) => {
        const file = e.target.files[0];
        const reader = new FileReader();
        
        reader.onload = (event) => {
          try {
            const data = JSON.parse(event.target.result);
            
            Swal.fire({
              title: '‡¶°‡ßá‡¶ü‡¶æ ‡¶∞‡¶ø‡¶∏‡ßç‡¶ü‡ßã‡¶∞ ‡¶ï‡¶∞‡¶¨‡ßá‡¶®?',
              text: '‡¶¨‡¶∞‡ßç‡¶§‡¶Æ‡¶æ‡¶® ‡¶°‡ßá‡¶ü‡¶æ ‡¶™‡ßç‡¶∞‡¶§‡¶ø‡¶∏‡ßç‡¶•‡¶æ‡¶™‡¶ø‡¶§ ‡¶π‡¶¨‡ßá!',
              icon: 'warning',
              showCancelButton: true,
              confirmButtonText: '‡¶π‡ßç‡¶Ø‡¶æ‡¶Å, ‡¶∞‡¶ø‡¶∏‡ßç‡¶ü‡ßã‡¶∞ ‡¶ï‡¶∞‡ßÅ‡¶®',
              cancelButtonText: '‡¶¨‡¶æ‡¶§‡¶ø‡¶≤',
              customClass: { popup: 'smaller-popup' }
            }).then((result) => {
              if (result.isConfirmed) {
                if (data.cashData) localStorage.setItem("cashData", JSON.stringify(data.cashData));
                if (data.dueData) localStorage.setItem("dueData", JSON.stringify(data.dueData));
                if (data.loanData) localStorage.setItem("loanData", JSON.stringify(data.loanData));
                if (data.transactionHistory) localStorage.setItem("transactionHistory", JSON.stringify(data.transactionHistory));
                
                addToHistory('‡¶∞‡¶ø‡¶∏‡ßç‡¶ü‡ßã‡¶∞', '‡¶¨‡ßç‡¶Ø‡¶æ‡¶ï‡¶Ü‡¶™ ‡¶•‡ßá‡¶ï‡ßá ‡¶°‡ßá‡¶ü‡¶æ ‡¶™‡ßÅ‡¶®‡¶∞‡ßÅ‡¶¶‡ßç‡¶ß‡¶æ‡¶∞ ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá');
                
                Swal.fire({
                  icon: 'success',
                  title: '‡¶∞‡¶ø‡¶∏‡ßç‡¶ü‡ßã‡¶∞ ‡¶∏‡¶´‡¶≤!',
                  text: '‡¶™‡ßá‡¶ú ‡¶∞‡¶ø‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...',
                  timer: 1500,
                  customClass: { popup: 'smaller-popup' }
                }).then(() => location.reload());
              }
            });
          } catch (error) {
            Swal.fire({
              icon: 'error',
              title: '‡¶§‡ßç‡¶∞‡ßÅ‡¶ü‡¶ø!',
              text: '‡¶´‡¶æ‡¶á‡¶≤ ‡¶™‡¶°‡¶º‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá',
              customClass: { popup: 'smaller-popup' }
            });
          }
        };
        
        reader.readAsText(file);
      };
      
      input.click();
    }

    function exportCSV() {
      let csv = '‡¶π‡¶ø‡¶∏‡¶æ‡¶¨ ‡¶ñ‡¶æ‡¶§‡¶æ ‡¶∞‡¶ø‡¶™‡ßã‡¶∞‡ßç‡¶ü - ' + new Date().toLocaleDateString() + '\n\n';
      
      csv += '‡¶ï‡ßç‡¶Ø‡¶æ‡¶∂ ‡¶ü‡¶æ‡¶ï‡¶æ\n';
      csv += '‡¶∏‡ßã‡¶∞‡ßç‡¶∏,‡¶è‡¶Æ‡¶æ‡¶â‡¶®‡ßç‡¶ü\n';
      cashData.forEach(entry => {
        csv += `"${entry.method}",${entry.amount}\n`;
      });
      
      csv += '\n‡¶¨‡¶æ‡¶ï‡¶ø ‡¶π‡¶ø‡¶∏‡¶æ‡¶¨\n';
      csv += '‡¶®‡¶æ‡¶Æ,‡¶è‡¶Æ‡¶æ‡¶â‡¶®‡ßç‡¶ü,‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ\n';
      dueData.forEach(entry => {
        csv += `"${entry.person}",${entry.amount},"${entry.timestamp}"\n`;
      });
      
      csv += '\n‡¶≤‡ßã‡¶® ‡¶è‡¶∞ ‡¶π‡¶ø‡¶∏‡¶æ‡¶¨\n';
      csv += '‡¶®‡¶æ‡¶Æ,‡¶è‡¶Æ‡¶æ‡¶â‡¶®‡ßç‡¶ü,‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ\n';
      loanData.forEach(entry => {
        csv += `"${entry.person}",${entry.amount},"${entry.timestamp}"\n`;
      });
      
      let currentTotal = 0, totalDue = 0, totalLoan = 0;
      cashData.forEach(entry => currentTotal += parseFloat(entry.amount) || 0);
      dueData.forEach(entry => totalDue += parseFloat(entry.amount) || 0);
      loanData.forEach(entry => totalLoan += parseFloat(entry.amount) || 0);
      const grandTotal = currentTotal + totalDue - totalLoan;
      
      csv += '\n‡¶∏‡¶æ‡¶Æ‡¶æ‡¶∞‡¶ø\n';
      csv += `‡¶¨‡¶∞‡ßç‡¶§‡¶Æ‡¶æ‡¶® ‡¶ï‡ßç‡¶Ø‡¶æ‡¶∂,‡ß≥${currentTotal}\n`;
      csv += `‡¶™‡¶æ‡¶ì‡¶®‡¶æ ‡¶¨‡¶æ‡¶ï‡¶ø,‡ß≥${totalDue}\n`;
      csv += `‡¶≤‡ßã‡¶®,‡ß≥${totalLoan}\n`;
      csv += `‡¶∏‡¶∞‡ßç‡¶¨‡¶Æ‡ßã‡¶ü,‡ß≥${grandTotal}\n`;
      
      const blob = new Blob(['\ufeff' + csv], { type: 'text/csv;charset=utf-8;' });
      const url = URL.createObjectURL(blob);
      const link = document.createElement('a');
      link.href = url;
      link.download = `hishabkhata-${new Date().toISOString().split('T')[0]}.csv`;
      link.click();
      URL.revokeObjectURL(url);
      
      addToHistory('CSV ‡¶è‡¶ï‡ßç‡¶∏‡¶™‡ßã‡¶∞‡ßç‡¶ü', 'CSV ‡¶´‡¶æ‡¶á‡¶≤ ‡¶°‡¶æ‡¶â‡¶®‡¶≤‡ßã‡¶° ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá');
      showToast();
    }

    function showHistory() {
      if (transactionHistory.length === 0) {
        Swal.fire({
          icon: 'info',
          title: '‡¶ï‡ßã‡¶® ‡¶π‡¶ø‡¶∏‡ßç‡¶ü‡ßç‡¶∞‡¶ø ‡¶®‡ßá‡¶á',
          text: '‡¶è‡¶ñ‡¶®‡¶ì ‡¶ï‡ßã‡¶® ‡¶≤‡ßá‡¶®‡¶¶‡ßá‡¶® ‡¶∞‡ßá‡¶ï‡¶∞‡ßç‡¶° ‡¶®‡ßá‡¶á',
          customClass: { popup: 'smaller-popup' }
        });
        return;
      }
      
      const isDark = document.body.classList.contains('dark-theme');
      const textColor = isDark ? '#e0e0e0' : '#000';
      const subTextColor = isDark ? '#aaa' : '#666';
      
      let historyHTML = `<div style="max-height: 400px; overflow-y: auto; text-align: left; color: ${textColor};">`;
      transactionHistory.slice(0, 20).forEach((entry, index) => {
        historyHTML += `
          <div class="history-item">
            <strong style="color: ${textColor};">${entry.action}</strong><br>
            <small style="color: ${textColor};">${entry.details}</small><br>
            <small style="color: ${subTextColor};">${entry.timestamp}</small>
          </div>
        `;
      });
      historyHTML += '</div>';
      
      Swal.fire({
        title: '‡¶≤‡ßá‡¶®‡¶¶‡ßá‡¶® ‡¶π‡¶ø‡¶∏‡ßç‡¶ü‡ßç‡¶∞‡¶ø',
        html: historyHTML,
        width: '600px',
        showCloseButton: true,
        confirmButtonText: '‡¶¨‡¶®‡ßç‡¶ß ‡¶ï‡¶∞‡ßÅ‡¶®'
      });
    }

    function clearAllData() {
      Swal.fire({
        title: '‡¶∏‡¶¨ ‡¶°‡ßá‡¶ü‡¶æ ‡¶Æ‡ßÅ‡¶õ‡¶¨‡ßá‡¶®?',
        text: '‡¶è‡¶ü‡¶ø ‡¶™‡ßÇ‡¶∞‡ßç‡¶¨‡¶æ‡¶¨‡¶∏‡ßç‡¶•‡¶æ‡¶Ø‡¶º ‡¶´‡ßá‡¶∞‡¶æ‡¶®‡ßã ‡¶Ø‡¶æ‡¶¨‡ßá ‡¶®‡¶æ!',
        icon: 'warning',
        showCancelButton: true,
        confirmButtonColor: '#d33',
        cancelButtonColor: '#3085d6',
        confirmButtonText: '‡¶π‡ßç‡¶Ø‡¶æ‡¶Å, ‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶´‡ßá‡¶≤‡ßÅ‡¶®!',
        cancelButtonText: '‡¶¨‡¶æ‡¶§‡¶ø‡¶≤',
        customClass: { popup: 'smaller-popup' }
      }).then((result) => {
        if (result.isConfirmed) {
          localStorage.clear();
          Swal.fire({
            icon: 'success',
            title: '‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶´‡ßá‡¶≤‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá!',
            text: '‡¶∏‡¶ï‡¶≤ ‡¶°‡ßá‡¶ü‡¶æ ‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶´‡ßá‡¶≤‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá',
            timer: 1500,
            customClass: { popup: 'smaller-popup' }
          }).then(() => location.reload());
        }
      });
    }

    function showCharts() {
      let currentTotal = 0, totalDue = 0, totalLoan = 0;
      cashData.forEach(entry => currentTotal += parseFloat(entry.amount) || 0);
      dueData.forEach(entry => totalDue += parseFloat(entry.amount) || 0);
      loanData.forEach(entry => totalLoan += parseFloat(entry.amount) || 0);
      
      const chartHTML = `
        <div style="width: 100%; max-width: 500px; margin: auto;">
          <canvas id="summaryChart"></canvas>
        </div>
        <div style="width: 100%; max-width: 500px; margin: auto; margin-top: 30px;">
          <canvas id="cashBreakdownChart"></canvas>
        </div>
      `;
      
      Swal.fire({
        title: '‡¶Ü‡¶∞‡ßç‡¶•‡¶ø‡¶ï ‡¶ö‡¶æ‡¶∞‡ßç‡¶ü',
        html: chartHTML,
        width: '800px',
        showCloseButton: true,
        confirmButtonText: '‡¶¨‡¶®‡ßç‡¶ß ‡¶ï‡¶∞‡ßÅ‡¶®',
        didOpen: () => {
          const ctx1 = document.getElementById('summaryChart');
          new Chart(ctx1, {
            type: 'pie',
            data: {
              labels: ['‡¶¨‡¶∞‡ßç‡¶§‡¶Æ‡¶æ‡¶® ‡¶ï‡ßç‡¶Ø‡¶æ‡¶∂', '‡¶™‡¶æ‡¶ì‡¶®‡¶æ ‡¶¨‡¶æ‡¶ï‡¶ø', '‡¶≤‡ßã‡¶®'],
              datasets: [{
                label: '‡¶è‡¶Æ‡¶æ‡¶â‡¶®‡ßç‡¶ü (‡ß≥)',
                data: [currentTotal, totalDue, totalLoan],
                backgroundColor: [
                  'rgba(13, 202, 240, 0.8)',
                  'rgba(255, 193, 7, 0.8)',
                  'rgba(220, 53, 69, 0.8)'
                ],
                borderColor: [
                  'rgba(13, 202, 240, 1)',
                  'rgba(255, 193, 7, 1)',
                  'rgba(220, 53, 69, 1)'
                ],
                borderWidth: 2
              }]
            },
            options: {
              responsive: true,
              plugins: {
                legend: {
                  position: 'bottom',
                },
                title: {
                  display: true,
                  text: '‡¶∏‡¶æ‡¶Æ‡¶æ‡¶∞‡¶ø ‡¶¨‡¶ø‡¶§‡¶∞‡¶£'
                }
              }
            }
          });
          
          if (cashData.length > 0) {
            const ctx2 = document.getElementById('cashBreakdownChart');
            const cashLabels = cashData.map(e => e.method);
            const cashAmounts = cashData.map(e => parseFloat(e.amount) || 0);
            
            new Chart(ctx2, {
              type: 'bar',
              data: {
                labels: cashLabels,
                datasets: [{
                  label: '‡¶ï‡ßç‡¶Ø‡¶æ‡¶∂ ‡¶è‡¶Æ‡¶æ‡¶â‡¶®‡ßç‡¶ü (‡ß≥)',
                  data: cashAmounts,
                  backgroundColor: 'rgba(25, 135, 84, 0.8)',
                  borderColor: 'rgba(25, 135, 84, 1)',
                  borderWidth: 2
                }]
              },
              options: {
                responsive: true,
                plugins: {
                  legend: {
                    display: false
                  },
                  title: {
                    display: true,
                    text: '‡¶ï‡ßç‡¶Ø‡¶æ‡¶∂ ‡¶∏‡ßã‡¶∞‡ßç‡¶∏ ‡¶¨‡¶ø‡¶§‡¶∞‡¶£'
                  }
                },
                scales: {
                  y: {
                    beginAtZero: true
                  }
                }
              }
            });
          }
        }
      });
    }

    renderTables();
  </script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
</body>

</html>